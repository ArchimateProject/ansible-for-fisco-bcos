- block:
    - name: Create/update group_genesis.ini
      template:
        src: group_genesis.ini.j2
        dest: "{{ inventory_dir }}/agency_{{ agency_name }}/conf/group_genesis.ini"
        backup: true
        mode: 0666

    - name: Generating group genesis
      command: "{{ item }}"
      with_items:
        - "./generator --create_group_genesis ./group"
      args:
        chdir: "{{ inventory_dir }}/agency_{{ agency_name }}"
      changed_when: false
  when: agency_genesis | default(false)

# - name: Transfer genesis block to other agency under the same group
#   copy:
#     src: "{{ inventory_dir }}/agency_{{ item.0 }}/group/group.{{ item.0.agency_group_id }}.genesis"
#     dest: "{{ inventory_dir }}/generator-{{ item.1.agency_name }}/meta/group.{{ item.0.agency_group_id }}.genesis"
#   args:
#     warn: false
#   when: not agency_genesis | default(false)
#   with_together:
#     - "{{ groups['group_genesis_creator'] | map('extract', hostvars) | map(attribute='agency_name') | list }}"
#     - "{{ groups['group_genesis_follower'] }}"
